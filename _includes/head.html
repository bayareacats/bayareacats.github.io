<head>
    <style>
        html {visibility: hidden;opacity:0;}
    </style>

    <noscript>
        <link rel="stylesheet" href="{{ site.baseurl }}/css/skel.css" />
        <link rel="stylesheet" href="{{ site.baseurl }}/css/style.css" />
    </noscript>

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-EFGGZ0CZBZ"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-EFGGZ0CZBZ');
    </script>

    <title>{% if page.title %}{{ page.title }}{% else %}{{ site.title }}{% endif %}</title>
    <link rel="shortcut icon" id="favicon" type="image/x-icon" href="/images/favicon-dark.ico">

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="{% if page.description %}{{ page.description }}{% else %}{{ site.description }}{% endif %}" />
    <meta name="keywords" content="{{ page.keywords | default: site.keywords }}" />
    <!--[if lte IE 8]><script src="js/html5shiv.js"></script><![endif]-->
    <script src="{{ site.baseurl }}/js/jquery.min.js"></script>
    <script src="{{ site.baseurl }}/js/skel.min.js"></script>
    <script src="{{ site.baseurl }}/js/skel-layers.min.js"></script>
    <script src="{{ site.baseurl }}/js/init.js"></script>


    <script>
      const usesDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches || false;
      const favicon = document.getElementById("favicon");

      function switchIcon(usesDarkMode) {
        if (usesDarkMode) {
          favicon.href = '/images/favicon-dark.ico';
        } else {
          favicon.href = '/images/favicon-light.ico';
        }
      }

      window.matchMedia('(prefers-color-scheme: dark)').addEventListener( "change", (e) => switchIcon(e.matches));
      switchIcon(usesDarkMode);
    </script>

    {% assign redirect_url = page.redirect_url %}
    {% if redirect_url %}
        {% assign gtag_event_name = page.gtag_event_name | default: 'redirected' %}

        <script>
          (function () {
            const redirectUrl = {{ redirect_url | jsonify }};
            const gtagEventName = {{ gtag_event_name | jsonify }};
            const callbackFallbackMs = 800;
            const hardFallbackMs = 1500;

            function go() {
              let redirected = false;

              const hard = setTimeout(function () {
                if (!redirected) {
                  redirected = true;
                  window.location.href = redirectUrl;
                }
              }, hardFallbackMs);

              if (typeof window.gtag === 'function' && gtagEventName) {
                const soft = setTimeout(function () {
                  if (!redirected) {
                    redirected = true;
                    clearTimeout(hard);
                    window.location.href = redirectUrl;
                  }
                }, callbackFallbackMs);

                window.gtag('event', gtagEventName, {
                  event_callback: function () {
                    if (!redirected) {
                      redirected = true;
                      clearTimeout(soft);
                      clearTimeout(hard);
                      window.location.href = redirectUrl;
                    }
                  },
                  event_timeout: callbackFallbackMs - 100
                });
              } else {
                setTimeout(function () {
                  if (!redirected) {
                    redirected = true;
                    clearTimeout(hard);
                    window.location.href = redirectUrl;
                  }
                }, 200);
              }
            }

            if (document.readyState === 'loading') {
              document.addEventListener('DOMContentLoaded', go);
            } else {
              go();
            }
          })();
        </script>
    {% endif %}
</head>
